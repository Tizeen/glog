<!DOCTYPE html>
<html lang="zh-cn">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Glog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="">
    <meta name="generator" content="Hugo 0.148.0">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    


    
      

    

    
    
      <link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Glog" />
      <link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="Glog" />
      
    

    
      <link rel="canonical" href="http://localhost:1313/posts/">
    

    <meta property="og:url" content="http://localhost:1313/posts/">
  <meta property="og:site_name" content="Glog">
  <meta property="og:title" content="Posts">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Posts">
  <meta itemprop="datePublished" content="2025-05-25T04:40:56+00:00">
  <meta itemprop="dateModified" content="2025-05-25T04:40:56+00:00">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Posts">

	
  </head><body class="ma0 avenir bg-near-white development">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Glog
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          Posts
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="pa3 pa4-ns nested-copy-line-height">
    <section class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy nested-links mid-gray"></section>
    <section class="flex-ns mt5 flex-wrap justify-around">
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        July 18, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/07/18/%E8%B7%A8%E5%9F%9F/" class="link black dim">
        跨域
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h2 class="wp-block-heading" id="跨域是什么">跨域是什么</h2>
<p>跨域只发生在浏览器的访问中，发生跨域时，通常会看到 CORS error 等字眼，并且请求返回了 403 状态码。<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" decoding="async" width="1024" height="57" src="https://glog.likungong.com/wp-content/uploads/2024/07/image-2-1024x57.png" alt="" class="wp-image-179" srcset="https://glog.likungong.com/wp-content/uploads/2024/07/image-2-1024x57.png 1024w, https://glog.likungong.com/wp-content/uploads/2024/07/image-2-300x17.png 300w, https://glog.likungong.com/wp-content/uploads/2024/07/image-2-768x43.png 768w, https://glog.likungong.com/wp-content/uploads/2024/07/image-2.png 1080w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /> </figure></p>
<h2 class="wp-block-heading" id="为什么会跨域">为什么会跨域</h2>
<p>在理解跨域之前，要先知道浏览器中的同源策略。</p>
<p>同源策略：是指两个页面具有相同的协议、地址、端口，那么它们就是同源，只要有一个不同，就不是同源。不同源之间的访问，就会产生跨域。</p>
<p>例如 <a href="https://a.com">https://a.com</a> 页面里边的 JavaScript 脚本去访问 <a href="https://b.com">https://b.com</a> ，就会产生跨域的情况。</p>
<p>同源策略的目的是为了保护用户隐私和数据安全，但是我们还是有需要进行合法的跨域访问的。比如我们的图片资源都是存在一个独立的 CDN 资源中，其他业务都统一来这个域名访问资源，这之间就会产生跨域的情况。</p>
<h2 class="wp-block-heading" id="如何解决跨域">如何解决跨域</h2>
<p>目前最常见解决跨域的办法，就是通过 CORS(跨域资源共享)。</p>
<p>CORS(跨域资源共享)：通过设置HTTP头来允许跨域请求。</p>
<p>在上述的例子中，a.com 如何知道自己能够跨域访问 b.com 呢？它会在发起 GET、POST 等这些请求前，先发起一个 preflight 的请求，也就是 OPTIONS 请求，根据返回判断 b.com 是否允许自己访问。</p>
<p>需要注意的一点是，并不是所有的跨域都会发起 preflight 请求，同时满足以下情况是不会发起 OPTIONS 请求的：</p>
<ol class="wp-block-list">
  <li>
    请求方法是 GET、POST、HEAD
  </li>
  <li>
    请求中没有特殊的请求头
  </li>
</ol>
<p>跨域主要涉及的请求头信息：</p>
<ul class="wp-block-list">
  <li>
    Access-Control-Allow-Origin&nbsp;用于设置允许跨域请求源地址 （预检请求和正式请求在跨域时候都会验证）
  </li>
  <li>
    Access-Control-Allow-Headers&nbsp;跨域允许携带的特殊头信息字段 （只在预检请求验证）
  </li>
  <li>
    Access-Control-Allow-Methods&nbsp;跨域允许的请求方法或者说HTTP动词 （只在预检请求验证）
  </li>
  <li>
    Access-Control-Allow-Credentials&nbsp;是否允许跨域使用cookies，如果要跨域使用cookies，可以添加上此请求响应头，值设为true（设置或者不设置，都不会影响请求发送，只会影响在跨域时候是否要携带cookies，但是如果设置，预检请求和正式请求都需要设置）
  </li>
</ul>
<p>安全起见，Access-Control-Allow-Origin 一般不会设置 * 对所有开放，而是指定域名开放</p>
<h3 class="wp-block-heading" id="nginx中解决跨域">Nginx中解决跨域</h3>
<p>在 Nginx 的配置中，需要处理 OPTIONS 请求，同时对于 OPTIONS 之后的请求也需要添加对应的响应头</p>
    </div>
  <a href="/2024/07/18/%E8%B7%A8%E5%9F%9F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        May 31, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/05/31/k8s-serviceaccount/" class="link black dim">
        K8S ServiceAccount
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>近期又频繁接触 K8S，发现以前自己学的很多都已经发生变化，觉得有必要记录一下。</p>
<h2 class="wp-block-heading" id="serviceaccount是什么">ServiceAccount是什么</h2>
<p>服务账号，顾名思义是用来做身份标识的，它与平时接触的账号又有一些不一样。在 K8S 中，Pod、系统组件以及集群外的实体都可以使用 <strong>ServiceAccount 凭证</strong> 标识自己为对应的 ServiceAccount，以此来获取访问 K8S 其他资源的权限。</p>
<p>可以通过以下命令查看 ServiceAccount</p>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-bash" data-lang="Bash"><code>kubectl get sa -n default</code></pre>
</div>
<h2 class="wp-block-heading" id="serviceaccount使用场景">ServiceAccount使用场景</h2>
<p>目前接触到的使用场景有这些：</p>
<ol class="wp-block-list">
  <li>
    利用 ServiceAccount 的 secret，生成一个 kubeconfig 作为 CD 流水线中操作 K8S 的凭证
  </li>
  <li>
    在 Pod 中利用 ServiceAccount 和 K8S 自身通信，调用 API 启动 JOB 类型的 Pod，或者拿到 configmap 中的配置
  </li>
  <li>
    将 AWS 的 role 绑定到对应的 ServiceAccount，使 Pod 拥有对应 role 的权限，比如直接访问 S3 的权限
  </li>
</ol>
<h3 class="wp-block-heading" id="使用serviceaccount-token生成kubeconfig">使用ServiceAccount token生成kubeconfig</h3>
<p>通过以下方法创建一个长期有效的 Token（<strong>长期有效的 token 可能造成安全问题</strong>，谨慎使用），主要是<br>
<code>type: kubernetes.io/service-account-token</code></p>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-bash" data-lang="Bash"><code>kubectl apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Secret
metadata:
  name: sa-secret
  annotations:
    kubernetes.io/service-account.name: sa
type: kubernetes.io/service-account-token
EOF</code></pre>
</div>
<p>查看 token</p>
    </div>
  <a href="/2024/05/31/k8s-serviceaccount/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        May 14, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/05/14/%E5%AF%B9ci%E3%80%81cd%E7%9A%84%E7%90%86%E8%A7%A3%E8%AE%B0%E5%BD%95/" class="link black dim">
        对CI、CD的理解记录
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>近期又接触了阿里云 flow 这个工具，发现自己对 CI、CD 这块一直没有比较成型的记忆，所以简单整理记录一下。</p>
<h2 class="wp-block-heading" id="ci-cd是什么">CI CD是什么</h2>
<blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow">
  <p>
  </p>
<p><cite>CI：持续集成，开发人员在每次更改代码后都会将代码提交到版本控制系统。然后，CI 服务器会自动构建、测试和验证代码。<br /><br />CD：持续交付/部署，持续部署到服务器中。</cite></p>
</blockquote>
<p>CI、CD 的整个过程都是围绕着自动化产生的，力求做到更快、更可靠的交付。</p>
<h2 class="wp-block-heading" id="制品">制品</h2>
<p>制品可以理解是 CI 的产物，它可以是一个 Jar 包、一个 Docker 镜像、一个二进制文件。</p>
<p>制品是连接 CI 、CD 的传动轴。</p>
<p>制品不应该是死的，应该给它赋予 <strong>元数据</strong>，这些元数据可以标识制品是否被测试过、是否符合上线的标准，从而定义好 <strong>制品的生命周期</strong>。Jfrog Artifactory 很好的体现了这一点，而 Nexus 只是单纯的存储仓库，想要做到元数据，还需要额外的系统进行配合。</p>
<p>制品生命周期：</p>
<ol class="wp-block-list">
  <li>
    开发阶段，对应 dev 仓库，保留最近15天的数据
  </li>
  <li>
    测试阶段，对应 test 仓库，保留最近15天的数据
  </li>
  <li>
    预发布阶段，对应 stage 仓库，制品永久保留
  </li>
  <li>
    正式发布，对应 release 仓库，制品应该是从 stage 仓库 Promete 提升上来的，也需要永久保留
  </li>
</ol>
<h2 class="wp-block-heading" id="如何设计ci-cd流水线">如何设计CI CD流水线</h2>
<p>目前主要接触过 2 种设计：</p>
<ol class="wp-block-list">
  <li>
    CI、CD 所有功能都集中在一条 pipeline 中。这种方法适用于 pipeline 不复杂的情况，能够一步到位，完成所有事情。
  </li>
  <li>
    CI、CD 分两条不同的 pipeline，各自负责相应的事情。通过制品使 CI、CD 关联起来，分开的 CI、CD 相对更加灵活，权限管控更加方便。
  </li>
</ol>
<p>串行和并行：例如代码扫描和编译和并行执行，提升效率</p>
    </div>
  <a href="/2024/05/14/%E5%AF%B9ci%E3%80%81cd%E7%9A%84%E7%90%86%E8%A7%A3%E8%AE%B0%E5%BD%95/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        April 27, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/04/27/dig-trace-%E8%BE%93%E5%87%BA%E8%A7%A3%E8%AF%BB/" class="link black dim">
        dig &#43;trace 输出解读
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>这几天遇到了一个 DNS 问题，然后在使用 dig 的过程中，很多字段自己只是一知半解，有点模糊，特意抽时间了解了这方面的内容，顺便记录一下。</p>
<h3 class="wp-block-heading" id="dns递归解析过程">DNS递归解析过程</h3>
<p>DNS 服务器分类：</p>
<ol class="wp-block-list">
  <li>
    递归 DNS 解析器<br />类似运营商下发的 DNS 服务器或者像阿里云、腾讯云 dnspod 这种，都是递归 DNS 解析器，其中像阿里云、腾讯云这种对公共开放的 DNS，也称 <strong>公共 DNS</strong>
  </li>
  <li>
    根域名服务器
  </li>
  <li>
    TLD 名称服务器<br />顶级域名服务器，类似 <strong>.com</strong> ，<strong>.org </strong>这种
  </li>
  <li>
    权威性域名服务器<br />类似 <strong>ns-115.awsdns-14.com.</strong> ，会给你返回最终的解析结果给到递归 DNS 解析器，递归 DNS 解析器再返回给客户端
  </li>
</ol>
<p>递归 DNS 的解析过程，引用 cloudflare 的示意图，更详细的过程参考 <a href="https://www.cloudflare.com/zh-cn/learning/dns/what-is-dns/">cloudflare文档</a><figure class="wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex"> &lt;figure data-wp-context=&quot;{&ldquo;imageId&rdquo;:&ldquo;686e6d3a41e11&rdquo;}&quot; data-wp-interactive=&ldquo;core/image&rdquo; class=&ldquo;wp-block-image size-large wp-lightbox-container&rdquo;&gt;</p>
<img loading="lazy" decoding="async" width="1024" height="512" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on-async--click="actions.showLightbox" data-wp-on-async--load="callbacks.setButtonStyles" data-wp-on-async-window--resize="callbacks.setButtonStyles" data-id="123" src="https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-1024x512.png" alt="" class="wp-image-123" srcset="https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-1024x512.png 1024w, https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-300x150.png 300w, https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-768x384.png 768w, https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-1536x768.png 1536w, https://glog.likungong.com/wp-content/uploads/2024/04/what_is_a_dns_server_dns_lookup-2048x1024.png 2048w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /> 
			<button
			class="lightbox-trigger"
			type="button"
			aria-haspopup="dialog"
			aria-label="放大"
			data-wp-init="callbacks.initTriggerButton"
			data-wp-on-async--click="actions.showLightbox"
			data-wp-style--right="state.imageButtonRight"
			data-wp-style--top="state.imageButtonTop"
		> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 12 12"> <path fill="#fff" d="M2 0a2 2 0 0 0-2 2v2h1.5V2a.5.5 0 0 1 .5-.5h2V0H2Zm2 10.5H2a.5.5 0 0 1-.5-.5V8H0v2a2 2 0 0 0 2 2h2v-1.5ZM8 12v-1.5h2a.5.5 0 0 0 .5-.5V8H12v2a2 2 0 0 1-2 2H8Zm2-12a2 2 0 0 1 2 2v2h-1.5V2a.5.5 0 0 0-.5-.5H8V0h2Z" /> </svg> </button></figure> </figure> 
<h3 class="wp-block-heading" id="dig-trace">dig +trace</h3>
<p>dig 使用 <code>+trace</code> 之后，会从根域名服务器开始，一步一步 trace 整个域名的解析过程</p>
    </div>
  <a href="/2024/04/27/dig-trace-%E8%BE%93%E5%87%BA%E8%A7%A3%E8%AF%BB/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        April 19, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/04/19/%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9Adocker-compose%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E6%AE%B5/" class="link black dim">
        如何指定docker compose中容器的网段
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>Docker 安装后，看到 <code>docker0</code> 网卡使用的是 <code>172.17.0.1/16</code> 网段，后续 <code>Docker Run</code> 运行起来不指定网络的容器，拿到的网络地址都是属于这个网段。</p>
<p>但是对于利用 Docker Compose 启动得到的容器，它们的 IP 地址并不是从 <code>172.17.0.1/16</code> 网段获取的，而是重新创建了一个虚拟网卡，分配了一个新的网给它的容器的使用。</p>
<p>默认 Docker Compose 会从 <code>172.16.0.0/12</code> 网络的地址范围 （<code>172.16.0.0/16</code> ~ <code>172.31.255.255/16）</code> 中挑选一个不重复的进行使用。但是有的时候 Docker Compose 挑选到的网络会和我们网络内其他网段冲突，就会导致容器和那个网络段的服务访问会有问题（路由会有问题），这个时候我们就要手动指定网段，解决网络冲突。</p>
<p>配置如下：</p>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-json" data-lang="JSON"><code>version: &#39;3&#39;
<p>services:
frontend:
image: frontend-app
networks:
- custom-network</p>
<p>backend:
image: backend-app
networks:
- custom-network</p>
<p>networks:
custom-network:
driver: bridge
ipam:
config:
- subnet: 192.168.250.0/24</code></pre></p>
</div>
    </div>
  <a href="/2024/04/19/%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9Adocker-compose%E4%B8%AD%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E6%AE%B5/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        April 14, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/04/14/%E5%AF%B9%E8%87%AA%E5%B7%B1%E8%81%8C%E4%B8%9A%E7%9A%84%E6%80%9D%E8%80%83/" class="link black dim">
        对自己职业的思考
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>近期，离开做了 3 年的公司，去了新公司，引起了我对自己整个职业过程的一些思考。</p>
<h3 class="wp-block-heading" id="过去的总结">过去的总结</h3>
<p>回想过去，主要可以分为以下阶段：</p>
<ol class="wp-block-list">
  <li>
    入门阶段。刚毕业踏入的一个公司，是我踏入 Linux 世界的引导者，当时办公都是用 Ubuntu ，也为后来做运维工作打下基础。<br />总体来说，当时时间很多，自己却没有方向，也没有寻求别人的意见，欠缺主动学习，也许当时稍微改变，后续的路线也会发生翻天覆地的变化。
  </li>
  <li>
    进步阶段。来到深圳入职新公司，无比饥渴的学习各种各样的知识，K8S、持续集成部署。<br />总体来说，接触了很多新东西，也算是走上了运维这条路，但是部门只有我一个运维，领导也给不了太多建议，自己也没有从外界获取相应的内容，逐渐迷茫至离职。回想起来，很多事情其实能做到更好，也能得到更多的进步，而自己却没有做到。
  </li>
  <li>
    停滞阶段。跳槽下一家做 DevOps，吃老本，Azure DevOps。<br />总体来说，吃老本，没有什么新突破，换汤不换药，到最后出走，最大的幸运是找到了未来老婆。
  </li>
  <li>
    云运维阶段。再来到下一家，进入云服务运维阶段，阿里云、AWS、IOT，同时也涉及到了一些运维开发工作。<br />总体来说，个人成熟很多，也接触了更多新东西，技能的面也有了扩展，但还是缺乏独当一面的能力。
  </li>
</ol>
<p>回顾整个工作进程，总感觉自己有很多地方做的不够好</p>
<ol class="wp-block-list">
  <li>
    积累太少。很多都是一点一点积累起来的，而自己有时执着于工具，而忽略了内容的重要性，经常放弃过去积累的东西，而不是去修补，去完善，导致进步缓慢。
  </li>
  <li>
    思考太少。体现在对问题、对当下、对未来的思考太少，喜欢逃避。很多事情其实能做到更好，总是后知后觉。
  </li>
  <li>
    交流太少。同行交流太少，也容易对网上的观点嗤之以鼻，不以为意，不深入思考。
  </li>
  <li>
    不够系统。一件事情只知其，不知其所以然。通过搜索解决了问题，后续却没有做整体学习，导致学到的知识生硬。
  </li>
</ol>
<h3 class="wp-block-heading" id="未来的想法">未来的想法</h3>
<p>在新公司整理了当前的业务情况，个人有点悲哀，业务的云化程度很高，在我看来很多事情其实开发在简单理解之后也能胜任，我需要考虑我能为团队带来什么。</p>
<p>云服务时代，降低了纯业务运维的重要性，使得开发可以兼当运维，在不算很大的场景下，这种方式能降低人员成本。</p>
<p>对当前工作是有一点悲观，也许发展前景不算太好，但总要养家糊口，还需要自己找到突破口。</p>
<p>大的方面：</p>
<ol class="wp-block-list">
  <li>
    <strong>学习方法调整</strong>。凡事讲究一个 What-How-Why，多积累，定期回顾。
  </li>
  <li>
    <strong>慢下来，也许会更快</strong>。一开始不要太过追求知识的全面性，有的时候更多是自己觉得掌握了，但一到实操却发现啥也不会，这时不如先掌握一个知识点，再以点破面。
  </li>
  <li>
    <strong>自信</strong>。不够自信，有的时候太在乎别人的看法。
  </li>
</ol>
<p>工作内容思考：</p>
<ol class="wp-block-list">
  <li>
    成本。云服务时代，成本的重视程度要提高。
  </li>
  <li>
    可观测。服务的可观测性，在微服务时代，服务的数量很多，提高可观测性，在问题发生时可以提供有效的排查数据。
  </li>
  <li>
    开发能力(自动化)。开发不是只局限于业务系统，并不是写业务才算开发，更多的时候要考虑用机器帮你完成事情，而不是自己手动完成。
  </li>
  <li>
    AI 能力。接轨 AI 时代，利用 AI 来提升自己的能力。
  </li>
</ol>
    </div>
  <a href="/2024/04/14/%E5%AF%B9%E8%87%AA%E5%B7%B1%E8%81%8C%E4%B8%9A%E7%9A%84%E6%80%9D%E8%80%83/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        April 2, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/04/02/sni/" class="link black dim">
        SNI
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 class="wp-block-heading" id="sni是什么">SNI是什么</h3>
<p>SNI: Server Name Indication 服务名称标识。顾名思义，是用来标识服务名的</p>
<p>服务名：一般表示的是网站域名</p>
<p>在现如今的 Web 服务器，一般同个 IP + 端口 会包含多个网站，在 https 协议中，每个域名可能都会有自己的证书，如果只有 IP 地址，在访问 https 的时候，服务端不足以判断访问哪个域名，从而可能导致 <strong>SSL证书错误</strong>。</p>
<p>SNI 就是用来标识访问的域名是哪个，起到一个引路的作用。</p>
<p>SNI 主要用在 https 中，在 http 中是没有 SNI 的，因为 http 没有 tls 握手的过程，直接通过请求头中的 Host 字段判断访问的哪个域名。</p>
<h3 class="wp-block-heading" id="sni的体现">SNI的体现</h3>
<p>SNI 主要在 TLS 握手的 client hello 的扩展信息中，以此发给服务端&lt;figure data-wp-context=&quot;{&ldquo;imageId&rdquo;:&ldquo;686e6d3a3f7fb&rdquo;}&quot; data-wp-interactive=&ldquo;core/image&rdquo; class=&ldquo;wp-block-image size-large wp-lightbox-container&rdquo;&gt;</p>
<img loading="lazy" decoding="async" width="1024" height="604" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on-async--click="actions.showLightbox" data-wp-on-async--load="callbacks.setButtonStyles" data-wp-on-async-window--resize="callbacks.setButtonStyles" src="https://glog.likungong.com/wp-content/uploads/2024/04/image-1024x604.png" alt="" class="wp-image-93" srcset="https://glog.likungong.com/wp-content/uploads/2024/04/image-1024x604.png 1024w, https://glog.likungong.com/wp-content/uploads/2024/04/image-300x177.png 300w, https://glog.likungong.com/wp-content/uploads/2024/04/image-768x453.png 768w, https://glog.likungong.com/wp-content/uploads/2024/04/image.png 1230w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /> 
			<button
			class="lightbox-trigger"
			type="button"
			aria-haspopup="dialog"
			aria-label="放大"
			data-wp-init="callbacks.initTriggerButton"
			data-wp-on-async--click="actions.showLightbox"
			data-wp-style--right="state.imageButtonRight"
			data-wp-style--top="state.imageButtonTop"
		> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 12 12"> <path fill="#fff" d="M2 0a2 2 0 0 0-2 2v2h1.5V2a.5.5 0 0 1 .5-.5h2V0H2Zm2 10.5H2a.5.5 0 0 1-.5-.5V8H0v2a2 2 0 0 0 2 2h2v-1.5ZM8 12v-1.5h2a.5.5 0 0 0 .5-.5V8H12v2a2 2 0 0 1-2 2H8Zm2-12a2 2 0 0 1 2 2v2h-1.5V2a.5.5 0 0 0-.5-.5H8V0h2Z" /> </svg> </button></figure> 
<p>在 Nginx 中配置多 https 的例子：</p>
    </div>
  <a href="/2024/04/02/sni/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        March 28, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/03/28/%E5%88%A9%E7%94%A8ssh-tunnel%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="link black dim">
        利用SSH Tunnel内网穿透
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>SSH 除了平时连接远程服务器外，还有不少其他的功能，刚好最近有这个需求，利用了 SSH Tunnel 实现内网穿透，这里简单记录一下。</p>
<h3 class="wp-block-heading" id="前提">前提</h3>
<ol class="wp-block-list">
  <li>
    需要访问的内网服务器 A
  </li>
  <li>
    有公网地址外网服务器 B
  </li>
</ol>
<p>利用公网服务器 B 来暴露服务器 A 中的端口，需要 A 主动通过 SSH 连接服务器 B</p>
<h3 class="wp-block-heading" id="配置过程">配置过程</h3>
<p>SSH 原生支持远程端口转发，在内网服务器 A 上执行以下命令：</p>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-bash" data-lang="Bash"><code># 内网服务器 A 上执行
# ssh -fN -R 23456:127.0.0.1:22 -i xxx.key B_user@B_public_ip</code></pre>
</div>
<p>命令解释：</p>
<ol class="wp-block-list">
  <li>
    23456 端口，是监听在公网服务器 B 上的
  </li>
  <li>
    127.0.0.1:22 表示将内网服务器 A 的 ssh 端口映射到公网服务器 23456 端口
  </li>
  <li>
    -f 表示后台运行
  </li>
  <li>
    -N 不执行远程命令。端口转发时使用
  </li>
</ol>
<p>这个时候在第三台服务器 C 上，就可以通过公网服务器 B 的公网地址 + 23456 端口，访问到内网服务器 A 了</p>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-bash" data-lang="Bash"><code># 三方服务器 C 上执行
$ ssh -p 23456 A_user@B_public_ip</code></pre>
</div>
<h3 class="wp-block-heading" id="进一步优化">进一步优化</h3>
<p>SSH 的连接有时会因为网络不稳定而断开，我们可以使用 <a href="https://github.com/Autossh/autossh">autossh</a> 这个工具来帮我们维持 SSH 连接，在断开时自动重连。</p>
    </div>
  <a href="/2024/03/28/%E5%88%A9%E7%94%A8ssh-tunnel%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        March 23, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/03/23/%E5%A6%82%E4%BD%95%E5%8F%AA%E6%9B%B4%E6%96%B0docker-compose%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84%E7%89%88%E6%9C%AC/" class="link black dim">
        如何只更新Docker Compose中某个容器的版本
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <p>遇到了很多次这个场景，发布版本的时候，只需要更新 Docker Compose 中某个容器的镜像版本并重启，不需要重启其他依赖的容器。</p>
<p>其实 Docker 已经为我们考虑到了这个问题了，并提供了相应的参数。</p>
<p>方法一：</p>
<ol class="wp-block-list">
  <li>
    更新 <code>docker-compose.yml </code>中的镜像 ID
  </li>
  <li>
    重新执行 <code>docker compose up -d </code>，会自动判断那个 service 发生了变化，并重启变化的容器
  </li>
</ol>
<p>方法二：</p>
<ol class="wp-block-list">
  <li>
    同样是更新 <code>docker-compose.yml</code> 中的镜像 ID
  </li>
  <li>
    执行 up 时，加上 <code>--no-deps</code> 的参数，也能做到不重启其他依赖容器。这种做法的好处是可以明确指定那个容器，如果有多个容器需要重启，能做到有顺序的重启
  </li>
</ol>
<div class="hcb_wrap">
  <pre class="prism line-numbers lang-bash" data-lang="Bash"><code>docker compose up -d --no-deps container_name</code></pre>
</div>
    </div>
  <a href="/2024/03/23/%E5%A6%82%E4%BD%95%E5%8F%AA%E6%9B%B4%E6%96%B0docker-compose%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84%E7%89%88%E6%9C%AC/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
        <div class="w-100 w-30-l mb4 relative bg-white">
            <div class="mb3 pa4 mid-gray overflow-hidden">
    
      <div class="f6">
        March 20, 2024
      </div>
    
    <h1 class="f3 near-black">
      <a href="/2024/03/20/k8s-pod-qos/" class="link black dim">
        K8S Pod QoS
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      <h3 class="wp-block-heading" id="pod-qos是什么">Pod QoS是什么</h3>
<p>QoS：Quality of Service，服务质量的意思。K8S Pod QoS 主要是对 Pod 的资源进行管理和限制的一种机制。</p>
<p>QoS类型：</p>
<ol class="wp-block-list">
  <li>
    Guaranteed：最高优先级<br />Pod 中每个容器的内存和 CPU 的 request 和 limit 是一致的，不同容器的配置值是可以不相等
  </li>
  <li>
    Burstable：可以短期使用更多的资源<br />&#8211; 设置了内存和 CPU 的 request，但是没有配置 limit<br />&#8211; 或者设置了 request 和 limit，但是两者不相等
  </li>
  <li>
    BestEffort：最低优先级<br />没有设置任何 request 和 limit
  </li>
</ol>
<p>如果 Pod 中只配置了 limit，没有配置 request，那么 K8S 会复制 limit 的值提供给 requests 。</p>
<blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow">
  <p>
    Note:
  </p>
<p><cite>If you specify a limit for a resource, but do not specify any request, and no admission-time mechanism has applied a default request for that resource, then Kubernetes copies the limit you specified and uses it as the requested value for the resource.</cite></p>
    </div>
  <a href="/2024/03/20/k8s-pod-qos/" class="ba b--moon-gray bg-light-gray br2 color-inherit dib f7 hover-bg-moon-gray link mt2 ph2 pv1">read more</a>
  </div>

        </div>
      
    </section>
    <ul class="pagination pagination-default">
      <li class="page-item">
        <a href="/posts/" aria-label="First" class="page-link" role="button"><span aria-hidden="true">&laquo;&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/" aria-label="Previous" class="page-link" role="button"><span aria-hidden="true">&laquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/" aria-label="Page 1" class="page-link" role="button">1</a>
      </li>
      <li class="page-item active">
        <a aria-current="page" aria-label="Page 2" class="page-link" role="button">2</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/3/" aria-label="Page 3" class="page-link" role="button">3</a>
      </li>
      <li class="page-item">
        <a href="/posts/page/3/" aria-label="Next" class="page-link" role="button"><span aria-hidden="true">&raquo;</span></a>
      </li>
      <li class="page-item">
        <a href="/posts/page/3/" aria-label="Last" class="page-link" role="button"><span aria-hidden="true">&raquo;&raquo;</span></a>
      </li>
    </ul></article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/" >
    &copy;  Glog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
