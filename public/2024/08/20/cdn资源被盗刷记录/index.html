<!DOCTYPE html>
<html lang="zh-cn"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="问题

  
    带宽使用从平时的 2Gbps 提升到了 20Gbps
  
  
    每日的 CDN 费用从 2000 上涨到了 20000
  

处理

  
    通过监控发现，现状已经持续了 5 天左右
  
  
    查看运营报表（阿里云自带），发现有几个特定的 IP 一直在访问一个 APK 资源，并且过去 7 天下载了 1.4PB 的流量
  
  
    在 CDN 控制台中封禁这些 IP，带宽使用下降
  
  
    发现攻击者切换 IP ，继续访问这个 APK 资源，带宽使用上涨
  
  
    配置此资源下载限速，一开始配置的 20MB，发现仅对单次连接生效，效果不佳，降低到最低限速 100Kb，带宽使用下降
  
  
    攻击者还是在切换 IP 持续访问
  
  
    确定资源是 2020 年的资源，目前已不在使用
  
  
    从源站中重命名资源，刷新 CDN 缓存，从而清除 CDN 中的缓存
  
  
    此时再访问资源 404，带宽使用恢复
  

思考
存在的问题：

  
    没有及时发现流量被盗刷
  
  
    没有限速机制
  
  
    历史资源没有生命周期管理机制，一直存在
  

如果攻击者更换了新的 IP 和资源，我们应该怎么办？

  
    需要考虑使用其他的特征来进行封禁，例如 User-Agent、Referer 等内容
  
  
    考虑接入 WAF ，利用 WAF 来封禁
  

应该如何防止此类事件？

  
    添加监控。对于按使用量计算的指标，可以添加对应的上限监控。例如：带宽、流量、费用
  
  
    配置下载限速
  
  
    建立资源的生命周期机制。没有资源的下线机制，冗余资源会越来越多
  

为什么被刷
网络上看到的解释，对比当时的场景十分符合，针对一个 url 不停的下载，去平衡 pcdn 的下载流量，避免家庭带宽上传过多被运营商封禁。">  

  <title>
    
      CDN资源被盗刷记录
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.900100e9dbee2d56c58fac8bb717037cae7e26a9c36c29d2ff587bdd65f0cbbe510b41d81a3bb234919cdfdc7550d786b2fab70c8fc507772d732fe097106d12.css" integrity="sha512-kAEA6dvuLVbFj6yLtxcDfK5&#43;JqnDbCnS/1h73WXwy75RC0HYGjuyNJGc39x1UNeGsvq3DI/FB3ctcy/glxBtEg==" />
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2024-08-20 02:17:45 &#43;0000 &#43;0000">
            2024-08-20
        </time>
    </p>

    <h1>CDN资源被盗刷记录</h1>

    

    <h2 class="wp-block-heading" id="问题">问题</h2>
<ol class="wp-block-list">
  <li>
    带宽使用从平时的 2Gbps 提升到了 20Gbps
  </li>
  <li>
    每日的 CDN 费用从 2000 上涨到了 20000
  </li>
</ol>
<h2 class="wp-block-heading" id="处理">处理</h2>
<ol class="wp-block-list">
  <li>
    通过监控发现，现状已经持续了 5 天左右
  </li>
  <li>
    查看运营报表（阿里云自带），发现有几个特定的 IP 一直在访问一个 APK 资源，并且过去 7 天下载了 1.4PB 的流量
  </li>
  <li>
    在 CDN 控制台中封禁这些 IP，带宽使用下降
  </li>
  <li>
    发现攻击者切换 IP ，继续访问这个 APK 资源，带宽使用上涨
  </li>
  <li>
    配置此资源下载限速，一开始配置的 20MB，发现仅对单次连接生效，效果不佳，降低到最低限速 100Kb，带宽使用下降
  </li>
  <li>
    攻击者还是在切换 IP 持续访问
  </li>
  <li>
    确定资源是 2020 年的资源，目前已不在使用
  </li>
  <li>
    从源站中重命名资源，刷新 CDN 缓存，从而清除 CDN 中的缓存
  </li>
  <li>
    此时再访问资源 404，带宽使用恢复
  </li>
</ol>
<h2 class="wp-block-heading" id="思考">思考</h2>
<p>存在的问题：</p>
<ol class="wp-block-list">
  <li>
    没有及时发现流量被盗刷
  </li>
  <li>
    没有限速机制
  </li>
  <li>
    历史资源没有生命周期管理机制，一直存在
  </li>
</ol>
<p>如果攻击者更换了新的 IP 和资源，我们应该怎么办？</p>
<ol class="wp-block-list">
  <li>
    需要考虑使用其他的特征来进行封禁，例如 User-Agent、Referer 等内容
  </li>
  <li>
    考虑接入 WAF ，利用 WAF 来封禁
  </li>
</ol>
<p><strong>应该如何防止此类事件？</strong></p>
<ol class="wp-block-list">
  <li>
    添加监控。对于按使用量计算的指标，可以添加对应的上限监控。例如：带宽、流量、费用
  </li>
  <li>
    配置下载限速
  </li>
  <li>
    建立资源的生命周期机制。没有资源的下线机制，冗余资源会越来越多
  </li>
</ol>
<h2 class="wp-block-heading" id="为什么被刷">为什么被刷</h2>
<p>网络上看到的解释，对比当时的场景十分符合，针对一个 url 不停的下载，去平衡 pcdn 的下载流量，避免家庭带宽上传过多被运营商封禁。<figure class="wp-block-image size-large"></p>
<p><img loading="lazy" decoding="async" width="1024" height="503" src="https://glog.likungong.com/wp-content/uploads/2024/08/图片-3-1024x503.png" alt="" class="wp-image-238" srcset="https://glog.likungong.com/wp-content/uploads/2024/08/图片-3-1024x503.png 1024w, https://glog.likungong.com/wp-content/uploads/2024/08/图片-3-300x147.png 300w, https://glog.likungong.com/wp-content/uploads/2024/08/图片-3-768x377.png 768w, https://glog.likungong.com/wp-content/uploads/2024/08/图片-3.png 1414w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /> </figure></p>

</article>

                

            </div>
        </main>
    </body>
</html>
